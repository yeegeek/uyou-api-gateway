apisix:
  node_listen: 9080
  enable_admin: true
  enable_admin_cors: true
  enable_debug: false
  enable_dev_mode: false
  enable_reuseport: true
  enable_ipv6: true
  
  # 启用路径参数支持 (如 /users/:id)
  router:
    http: radixtree_uri_with_parameter
  
  config_center: etcd
  
  # 安全提示: 生产环境应配置具体的 IP 白名单
  # 开发环境允许 Docker 网络内访问
  allow_admin:
    - 127.0.0.1/32
    - 172.16.0.0/12      # Docker 默认网络
    - 192.168.0.0/16     # 本地网络

deployment:
  role: traditional
  role_traditional:
    config_provider: etcd
  
  admin:
    admin_key:
      - name: "admin"
        # 此值会在启动时由 scripts/apisix-start.sh 从环境变量 APISIX_ADMIN_KEY 替换
        # 如果 .env 文件中 APISIX_ADMIN_KEY 为空，脚本会自动使用 openssl 生成
        key: "${{APISIX_ADMIN_KEY}}"
        role: admin
    
    enable_admin_cors: true
    # 安全提示: 生产环境应配置具体的 IP 白名单
    allow_admin:
      - 127.0.0.1/32
      - 172.16.0.0/12      # Docker 默认网络
      - 192.168.0.0/16     # 本地网络
    
    admin_listen:
      ip: 0.0.0.0
      port: 9180
  
  etcd:
    host:
      - "http://etcd:2379"
    prefix: "/apisix"
    timeout: 30

plugin_attr:
  prometheus:
    export_addr:
      ip: "0.0.0.0"
      port: 9091

nginx_config:
  error_log: "/usr/local/apisix/logs/error.log"
  error_log_level: "warn"
  
  http:
    access_log: "/usr/local/apisix/logs/access.log"
    access_log_format: '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $upstream_addr $upstream_status $upstream_response_time $request_time'
    
    keepalive_timeout: 60s
    client_header_timeout: 60s
    client_body_timeout: 60s
    send_timeout: 10s
    
    underscores_in_headers: "on"
    real_ip_header: "X-Real-IP"
    
    lua_shared_dict:
      prometheus-metrics: 15m
